; Test: Can we control the data pin with SET instead of OUT?
; This will tell us if it's an OUT-specific problem or a pin problem

.program test_set_both

.wrap_target
    set pins, 0b11      ; Both pins HIGH
    nop [31]
    set pins, 0b10      ; Frame HIGH, data LOW
    nop [31]
    set pins, 0b01      ; Frame LOW, data HIGH
    nop [31]
    set pins, 0b00      ; Both pins LOW
    nop [31]
.wrap

% c-sdk {
static inline void test_set_both_program_init(PIO pio, uint sm, uint offset, uint data_pin, uint frame_pin, float clk_div) {
    pio_sm_config c = test_set_both_program_get_default_config(offset);

    // Set BOTH pins as SET pins (data pin first, then frame pin)
    sm_config_set_set_pins(&c, data_pin, 2);  // 2 consecutive pins starting at data_pin
    sm_config_set_clkdiv(&c, clk_div);

    pio_sm_init(pio, sm, offset, &c);

    pio_gpio_init(pio, data_pin);
    pio_sm_set_consecutive_pindirs(pio, sm, data_pin, 2, true);  // Both as outputs

    pio_sm_set_enabled(pio, sm, true);
}
%}
